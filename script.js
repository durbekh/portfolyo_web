// Language translations
const translations = {
    uz: {
        name: "Durbek Hayotbekov",
        title: "Full Stack Developer",
        "about-title": "Haqimda",
        "about-text": "Men backend yo'nalishida ishlayotgan dasturchiman. Web ilovalar yaratish va ma'lumotlar bazasi bilan ishlashga qiziqaman. Hozirda IT sohasini o'rganmoqdaman va yaxshi dasturchi bo'lishga intilmoqdaman. Python dasturlash tilida yaxshi tajribaga egaman va Flask, FastAPI kabi frameworklardan foydalanishni bilaman. Ma'lumotlar bazasi bilan ishlashda SQLite va PostgreSQL ishlataman.",
        "age-label": "Yosh:",
        "age-value": "Dasturlashni o'rganishda",
        "location-label": "Manzil:",
        "location-value": "O'zbekiston",
        "education-label": "Ta'lim:",
        "education-value": "IT sohasi bo'yicha o'qiyapman",
        "interest-label": "Qiziqish:",
        "interest-value": "Backend Development",
        "skills-title": "Texnologiyalar",
        "frontend-title": "Frontend",
        "backend-title": "Backend",
        "database-title": "Ma'lumotlar bazasi",
        "tools-title": "Asboblar",
        "projects-title": "Loyihalar",
        "project1-title": "Telegram Bot",
        "project1-desc": "Rasm yuborilganda uning Telegram ID sini qaytaruvchi oddiy telegram bot.",
        "project2-title": "Kitob Bot",
        "project2-desc": "Boshlang'ich darajadagi kitob bot - kitoblar bilan ishlash uchun yaratilgan.",
        "project3-title": "Algoritmik Masalalar",
        "project3-desc": "Yozgan barcha kodlarimni joylashtirgan repository. Algoritmik masalalarni yechish.",
        "github-title": "GitHub",
        "github-desc": "Barcha loyihalarim GitHubda joylashgan. Profilimga kirib ko'ring va yulduzcha qo'shing!",
        "github-link": "ðŸ”— github.com/durbekh",
        "repos-label": "Repository",
        "years-label": "Yil Tajriba",
        "experience-title": "Tajriba",
        "exp1-date": "2024 - Hozirgacha",
        "exp1-title": "O'quvchi / Dasturchi",
        "exp1-desc": "Backend dasturlash yo'nalishida o'qiyapman va mustaqil loyihalar yaratmoqdaman. Python, Flask, FastAPI va ma'lumotlar bazasi bilan ishlayman.",
        "exp2-date": "2024",
        "exp2-title": "Telegram Botlar Yaratish",
        "exp2-desc": "Aiogram framework yordamida turli xil telegram botlar yaratdim. Kitob bot, rasm ID bot va boshqa foydali botlar.",
        "contact-title": "Bog'lanish",
        "contact-me-title": "Men bilan bog'lanish",
        "contact-text": "Agar sizda savollar bo'lsa yoki hamkorlikni istasangiz, Telegram, Gmail yoki GitHub orqali bog'laning. Men doimo yangi loyihalar va hamkorliklar uchun ochiqman!",
        "form-name-label": "Ism va Familiya",
        "form-name-placeholder": "Ism va Familiya",
        "form-email-label": "Email",
        "form-email-placeholder": "Email manzilingiz",
        "form-subject-label": "Mavzu",
        "form-subject-placeholder": "Nima haqida yozmoqchisiz?",
        "form-message-label": "Xabar",
        "form-message-placeholder": "Xabaringizni yozing...",
        "form-submit-btn": "Yuborish",
        "telegram-label": "Telegram",
        "gmail-label": "Gmail",
        "github-label": "GitHub",
        "contact-note": "Barcha loyihalarim va kodlarim GitHubda ko'rinadi. Profilimga tashrif buyuring va yulduzcha qo'shing!",
        "profile-placeholder": "Rasm qo'shing"
    },
    en: {
        name: "Durbek Hayotbekov",
        title: "Full Stack Developer",
        "about-title": "About Me",
        "about-text": "I am a developer working in the backend direction. I am interested in creating web applications and working with databases. I am currently studying the IT field and striving to become a good developer. I have good experience in Python programming language and know how to use frameworks like Flask and FastAPI. I work with SQLite and PostgreSQL for database management.",
        "age-label": "Age:",
        "age-value": "Learning Programming",
        "location-label": "Location:",
        "location-value": "Uzbekistan",
        "education-label": "Education:",
        "education-value": "Studying IT",
        "interest-label": "Interest:",
        "interest-value": "Backend Development",
        "skills-title": "Technologies",
        "frontend-title": "Frontend",
        "backend-title": "Backend",
        "database-title": "Database",
        "tools-title": "Tools",
        "projects-title": "Projects",
        "project1-title": "Telegram Bot",
        "project1-desc": "A simple telegram bot that returns the Telegram ID when an image is sent.",
        "project2-title": "Book Bot",
        "project2-desc": "A beginner-level book bot created for working with books.",
        "project3-title": "Algorithmic Problems",
        "project3-desc": "Repository containing all my code. Solving algorithmic problems.",
        "github-title": "GitHub",
        "github-desc": "All my projects are on GitHub. Visit my profile and give it a star!",
        "github-link": "ðŸ”— github.com/durbekh",
        "repos-label": "Repositories",
        "years-label": "Year Experience",
        "experience-title": "Experience",
        "exp1-date": "2024 - Present",
        "exp1-title": "Student / Developer",
        "exp1-desc": "I am studying backend programming and creating independent projects. I work with Python, Flask, FastAPI and databases.",
        "exp2-date": "2024",
        "exp2-title": "Creating Telegram Bots",
        "exp2-desc": "I created various telegram bots using the Aiogram framework. Book bot, image ID bot and other useful bots.",
        "contact-title": "Contact",
        "contact-me-title": "Contact Me",
        "contact-text": "If you have questions or want to collaborate, please contact via Telegram, Gmail or GitHub. I am always open to new projects and collaborations!",
        "form-name-label": "Full Name",
        "form-name-placeholder": "Your Full Name",
        "form-email-label": "Email",
        "form-email-placeholder": "Your Email Address",
        "form-subject-label": "Subject",
        "form-subject-placeholder": "What do you want to write about?",
        "form-message-label": "Message",
        "form-message-placeholder": "Write your message...",
        "form-submit-btn": "Send",
        "telegram-label": "Telegram",
        "gmail-label": "Gmail",
        "github-label": "GitHub",
        "contact-note": "All my projects and code are visible on GitHub. Visit my profile and give it a star!",
        "profile-placeholder": "Add Photo"
    },
    ru: {
        name: "Ð”ÑƒÑ€Ð±ÐµÐº Ð¥Ð°Ð¹Ð¾Ñ‚Ð±ÐµÐºÐ¾Ð²",
        title: "Full Stack Ð Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº",
        "about-title": "Ðž ÑÐµÐ±Ðµ",
        "about-text": "Ð¯ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº, Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‰Ð¸Ð¹ Ð² Ð½Ð°Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ð¸ backend. ÐœÐµÐ½Ñ Ð¸Ð½Ñ‚ÐµÑ€ÐµÑÑƒÐµÑ‚ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð²ÐµÐ±-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¹ Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ð° Ñ Ð±Ð°Ð·Ð°Ð¼Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…. Ð’ Ð½Ð°ÑÑ‚Ð¾ÑÑ‰ÐµÐµ Ð²Ñ€ÐµÐ¼Ñ Ð¸Ð·ÑƒÑ‡Ð°ÑŽ IT Ð¸ ÑÑ‚Ñ€ÐµÐ¼Ð»ÑŽÑÑŒ ÑÑ‚Ð°Ñ‚ÑŒ Ñ…Ð¾Ñ€Ð¾ÑˆÐ¸Ð¼ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¾Ð¼. Ð£ Ð¼ÐµÐ½Ñ Ñ…Ð¾Ñ€Ð¾ÑˆÐ¸Ð¹ Ð¾Ð¿Ñ‹Ñ‚ Ð² ÑÐ·Ñ‹ÐºÐµ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Python Ð¸ Ñ Ð·Ð½Ð°ÑŽ, ÐºÐ°Ðº Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ñ„Ñ€ÐµÐ¹Ð¼Ð²Ð¾Ñ€ÐºÐ¸ Flask Ð¸ FastAPI. Ð Ð°Ð±Ð¾Ñ‚Ð°ÑŽ Ñ SQLite Ð¸ PostgreSQL Ð´Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ Ð±Ð°Ð·Ð°Ð¼Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ….",
        "age-label": "Ð’Ð¾Ð·Ñ€Ð°ÑÑ‚:",
        "age-value": "Ð˜Ð·ÑƒÑ‡Ð°ÑŽ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ",
        "location-label": "ÐœÐµÑÑ‚Ð¾Ð¿Ð¾Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ:",
        "location-value": "Ð£Ð·Ð±ÐµÐºÐ¸ÑÑ‚Ð°Ð½",
        "education-label": "ÐžÐ±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¸Ðµ:",
        "education-value": "Ð˜Ð·ÑƒÑ‡Ð°ÑŽ IT",
        "interest-label": "Ð˜Ð½Ñ‚ÐµÑ€ÐµÑ:",
        "interest-value": "Backend Ð Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ°",
        "skills-title": "Ð¢ÐµÑ…Ð½Ð¾Ð»Ð¾Ð³Ð¸Ð¸",
        "frontend-title": "Frontend",
        "backend-title": "Backend",
        "database-title": "Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…",
        "tools-title": "Ð˜Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹",
        "projects-title": "ÐŸÑ€Ð¾ÐµÐºÑ‚Ñ‹",
        "project1-title": "Telegram Ð‘Ð¾Ñ‚",
        "project1-desc": "ÐŸÑ€Ð¾ÑÑ‚Ð¾Ð¹ telegram Ð±Ð¾Ñ‚, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Telegram ID Ð¿Ñ€Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐµ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ.",
        "project2-title": "ÐšÐ½Ð¸Ð¶Ð½Ñ‹Ð¹ Ð‘Ð¾Ñ‚",
        "project2-desc": "Ð‘Ð¾Ñ‚ Ð´Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ ÐºÐ½Ð¸Ð³Ð°Ð¼Ð¸ Ð½Ð°Ñ‡Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ ÑƒÑ€Ð¾Ð²Ð½Ñ.",
        "project3-title": "ÐÐ»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð—Ð°Ð´Ð°Ñ‡Ð¸",
        "project3-desc": "Ð ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹ ÑÐ¾ Ð²ÑÐµÐ¼ Ð¼Ð¾Ð¸Ð¼ ÐºÐ¾Ð´Ð¾Ð¼. Ð ÐµÑˆÐµÐ½Ð¸Ðµ Ð°Ð»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… Ð·Ð°Ð´Ð°Ñ‡.",
        "github-title": "GitHub",
        "github-desc": "Ð’ÑÐµ Ð¼Ð¾Ð¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñ‹ Ð½Ð°Ñ…Ð¾Ð´ÑÑ‚ÑÑ Ð½Ð° GitHub. ÐŸÐ¾ÑÐµÑ‚Ð¸Ñ‚Ðµ Ð¼Ð¾Ð¹ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»ÑŒ Ð¸ Ð¿Ð¾ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ Ð·Ð²ÐµÐ·Ð´Ñƒ!",
        "github-link": "ðŸ”— github.com/durbekh",
        "repos-label": "Ð ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¸",
        "years-label": "Ð“Ð¾Ð´ ÐžÐ¿Ñ‹Ñ‚Ð°",
        "experience-title": "ÐžÐ¿Ñ‹Ñ‚",
        "exp1-date": "2024 - ÐÐ°ÑÑ‚Ð¾ÑÑ‰ÐµÐµ Ð²Ñ€ÐµÐ¼Ñ",
        "exp1-title": "Ð¡Ñ‚ÑƒÐ´ÐµÐ½Ñ‚ / Ð Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº",
        "exp1-desc": "Ð˜Ð·ÑƒÑ‡Ð°ÑŽ backend Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¸ ÑÐ¾Ð·Ð´Ð°ÑŽ Ð½ÐµÐ·Ð°Ð²Ð¸ÑÐ¸Ð¼Ñ‹Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñ‹. Ð Ð°Ð±Ð¾Ñ‚Ð°ÑŽ Ñ Python, Flask, FastAPI Ð¸ Ð±Ð°Ð·Ð°Ð¼Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ….",
        "exp2-date": "2024",
        "exp2-title": "Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Telegram Ð‘Ð¾Ñ‚Ð¾Ð²",
        "exp2-desc": "Ð¡Ð¾Ð·Ð´Ð°Ð» Ñ€Ð°Ð·Ð»Ð¸Ñ‡Ð½Ñ‹Ðµ telegram Ð±Ð¾Ñ‚Ñ‹ Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ Ñ„Ñ€ÐµÐ¹Ð¼Ð²Ð¾Ñ€ÐºÐ° Aiogram. ÐšÐ½Ð¸Ð¶Ð½Ñ‹Ð¹ Ð±Ð¾Ñ‚, Ð±Ð¾Ñ‚ Ð´Ð»Ñ ID Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ð¹ Ð¸ Ð´Ñ€ÑƒÐ³Ð¸Ðµ Ð¿Ð¾Ð»ÐµÐ·Ð½Ñ‹Ðµ Ð±Ð¾Ñ‚Ñ‹.",
        "contact-title": "ÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ñ‹",
        "contact-me-title": "Ð¡Ð²ÑÐ¶Ð¸Ñ‚ÐµÑÑŒ ÑÐ¾ Ð¼Ð½Ð¾Ð¹",
        "contact-text": "Ð•ÑÐ»Ð¸ Ñƒ Ð²Ð°Ñ ÐµÑÑ‚ÑŒ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹ Ð¸Ð»Ð¸ Ð²Ñ‹ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸Ñ‡Ð°Ñ‚ÑŒ, ÑÐ²ÑÐ¶Ð¸Ñ‚ÐµÑÑŒ Ñ‡ÐµÑ€ÐµÐ· Telegram, Gmail Ð¸Ð»Ð¸ GitHub. Ð¯ Ð²ÑÐµÐ³Ð´Ð° Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚ Ð´Ð»Ñ Ð½Ð¾Ð²Ñ‹Ñ… Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¾Ð² Ð¸ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸Ñ‡ÐµÑÑ‚Ð²Ð°!",
        "form-name-label": "Ð˜Ð¼Ñ Ð¸ Ð¤Ð°Ð¼Ð¸Ð»Ð¸Ñ",
        "form-name-placeholder": "Ð’Ð°ÑˆÐµ Ð˜Ð¼Ñ Ð¸ Ð¤Ð°Ð¼Ð¸Ð»Ð¸Ñ",
        "form-email-label": "Email",
        "form-email-placeholder": "Ð’Ð°Ñˆ Email Ð°Ð´Ñ€ÐµÑ",
        "form-subject-label": "Ð¢ÐµÐ¼Ð°",
        "form-subject-placeholder": "Ðž Ñ‡ÐµÐ¼ Ð²Ñ‹ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ?",
        "form-message-label": "Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ",
        "form-message-placeholder": "ÐÐ°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ Ð²Ð°ÑˆÐµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ...",
        "form-submit-btn": "ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ",
        "telegram-label": "Telegram",
        "gmail-label": "Gmail",
        "github-label": "GitHub",
        "contact-note": "Ð’ÑÐµ Ð¼Ð¾Ð¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñ‹ Ð¸ ÐºÐ¾Ð´ Ð²Ð¸Ð´Ð½Ñ‹ Ð½Ð° GitHub. ÐŸÐ¾ÑÐµÑ‚Ð¸Ñ‚Ðµ Ð¼Ð¾Ð¹ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»ÑŒ Ð¸ Ð¿Ð¾ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ Ð·Ð²ÐµÐ·Ð´Ñƒ!",
        "profile-placeholder": "Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ñ„Ð¾Ñ‚Ð¾"
    }
};

// Current language
let currentLang = localStorage.getItem('language') || 'uz';

// Initialize language
function initLanguage() {
    updateLanguage(currentLang);
    
    // Set active language button
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.lang === currentLang) {
            btn.classList.add('active');
        }
    });
}

// Function to fade out all animated elements
function fadeOutAllElements() {
    // Fade out sections
    document.querySelectorAll('section').forEach(section => {
        section.classList.remove('visible');
        section.style.opacity = '0';
        section.style.transform = 'translateY(50px)';
        section.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
    });
    
    // Fade out cards and items
    document.querySelectorAll('.skill-card, .project-card, .info-item, .stat-card, .timeline-item').forEach(element => {
        element.classList.remove('scroll-visible');
        element.style.opacity = '0';
        element.style.transform = element.classList.contains('timeline-item') ? 'translateX(-30px)' : 'translateY(30px)';
        element.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
    });
    
    // Fade out header
    const header = document.querySelector('.header');
    if (header) {
        header.style.opacity = '0';
        header.style.transform = 'translateY(30px)';
        header.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
    }
}

// Function to fade in all animated elements
function fadeInAllElements() {
    // Fade in header first
    const header = document.querySelector('.header');
    if (header) {
        setTimeout(() => {
            header.style.opacity = '1';
            header.style.transform = 'translateY(0)';
        }, 100);
    }
    
    // Fade in sections with delays
    document.querySelectorAll('section').forEach((section, index) => {
        setTimeout(() => {
            section.style.opacity = '1';
            section.style.transform = 'translateY(0)';
            section.classList.add('visible');
        }, 150 + (index * 100));
    });
    
    // Fade in cards and items with staggered delays
    setTimeout(() => {
        document.querySelectorAll('.skill-card, .project-card, .info-item, .stat-card').forEach((element, index) => {
            setTimeout(() => {
                element.style.opacity = '1';
                element.style.transform = 'translateY(0)';
                element.classList.add('scroll-visible');
            }, index * 50);
        });
        
        document.querySelectorAll('.timeline-item').forEach((element, index) => {
            setTimeout(() => {
                element.style.opacity = '1';
                element.style.transform = 'translateX(0)';
                element.classList.add('scroll-visible');
            }, index * 80);
        });
    }, 250);
}

// Update language with smooth transition
function updateLanguage(lang) {
    currentLang = lang;
    localStorage.setItem('language', lang);
    // Update document language attribute for accessibility and SEO
    if (document && document.documentElement) {
        document.documentElement.setAttribute('lang', lang);
    }
    
    // Fade out all elements
    fadeOutAllElements();
    
    // After fade-out, update content and fade-in
    setTimeout(() => {
        document.querySelectorAll('[data-key]').forEach(element => {
            const key = element.getAttribute('data-key');
            if (translations[lang] && translations[lang][key]) {
                // Inputs and textareas: update placeholder instead of textContent
                const tag = element.tagName.toLowerCase();
                if ((tag === 'input' || tag === 'textarea') && element.hasAttribute('placeholder')) {
                    element.setAttribute('placeholder', translations[lang][key]);
                } else {
                    // Check if element has child elements that should be preserved
                    const hasOnlyTextChildren = Array.from(element.children).length === 0 ||
                                               Array.from(element.children).every(child => child.hasAttribute('data-key'));
                    if (hasOnlyTextChildren || element.children.length === 0) {
                        element.textContent = translations[lang][key];
                    } else {
                        // For elements with non-translatable children, update text node while preserving structure
                        const firstTextNode = Array.from(element.childNodes).find(node => node.nodeType === 3);
                        if (firstTextNode) {
                            firstTextNode.textContent = translations[lang][key];
                        } else {
                            element.textContent = translations[lang][key];
                        }
                    }
                }
            }
        });
        
        // Fade in all elements
        fadeInAllElements();
    }, 500);
}

// Language button event listeners
document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
        const lang = btn.dataset.lang;
        updateLanguage(lang);
        
        document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        // Create smoke effect on language change
        const rect = btn.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;
        for (let i = 0; i < 15; i++) {
            createParticle(centerX, centerY);
        }
    });
});

// Theme Management
const themeToggle = document.getElementById('theme-toggle');
const body = document.body;

// Check saved theme
const savedTheme = localStorage.getItem('theme') || 'light';
if (savedTheme === 'dark') {
    body.classList.add('dark-mode');
    themeToggle.checked = true;
}

// Theme toggle event with smooth transition
themeToggle.addEventListener('change', () => {
    const rect = themeToggle.getBoundingClientRect();
    const centerX = rect.left + rect.width / 2;
    const centerY = rect.top + rect.height / 2;
    
    // Create smoke effect on theme change
    for (let i = 0; i < 20; i++) {
        createParticle(centerX, centerY);
    }
    
    // Update all existing particles to match new theme
    particles.forEach(particle => {
        particle.isDark = !body.classList.contains('dark-mode'); // Will be updated after theme change
    });
    
    // Fade out all elements
    fadeOutAllElements();
    
    // Add fade transition class
    body.style.transition = 'background-color 0.6s ease, color 0.6s ease';
    const container = document.querySelector('.container');
    if (container) {
        container.style.transition = 'opacity 1s ease, transform 1s ease';
        container.style.opacity = '0.7';
        container.style.transform = 'translateY(5px)';
    }
    
    // Update theme after slight delay for smooth transition
    setTimeout(() => {
        if (themeToggle.checked) {
            body.classList.add('dark-mode');
            localStorage.setItem('theme', 'dark');
            initCodeRain();
        } else {
            body.classList.remove('dark-mode');
            localStorage.setItem('theme', 'light');
            stopCodeRain();
        }
        
        // Update all particles to new theme
        particles.forEach(particle => {
            particle.isDark = body.classList.contains('dark-mode');
        });
        
        // Fade in all elements
        fadeInAllElements();
        
        // Fade back in container
        if (container) {
            container.style.opacity = '1';
            container.style.transform = 'translateY(0)';
        }
    }, 500);
});

// Mouse Trail Effect (Smoke) - Initialize after DOM is ready
let canvas, ctx;
let particles = [];
let mouseX = 0;
let mouseY = 0;
let isMouseMoving = false;
let isTouch = false;

// Initialize canvas when DOM is ready
function initSmokeEffect() {
    canvas = document.getElementById('smoke-canvas');
    if (!canvas) {
        console.error('Canvas element not found');
        return;
    }
    ctx = canvas.getContext('2d');
    
    if (!ctx) {
        console.error('Could not get 2D context');
        return;
    }
    
    // Ensure canvas is last in DOM so it stays on top visually
    if (canvas.parentNode !== document.body || document.body.lastElementChild !== canvas) {
        document.body.appendChild(canvas);
    }
    
    // Set initial canvas size
    setCanvasSize();
    
    // Start animation
    animateParticles();
}

// Set canvas size - ensure full coverage
function setCanvasSize() {
    if (!canvas || !ctx) return;
    
    const dpr = window.devicePixelRatio || 1;
    const width = Math.max(window.innerWidth, document.documentElement.clientWidth);
    const height = Math.max(window.innerHeight, document.documentElement.clientHeight);
    
    canvas.width = width * dpr;
    canvas.height = height * dpr;
    // Reset transform before applying DPR scale to avoid cumulative scaling
    if (ctx.setTransform) {
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    } else {
        ctx.resetTransform && ctx.resetTransform();
        ctx.scale(dpr, dpr);
    }
    canvas.style.width = width + 'px';
    canvas.style.height = height + 'px';
    
    // Clear and redraw on resize
    ctx.clearRect(0, 0, width, height);
}

// Remove duplicate declarations - already declared above

// Check if mobile device
const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

// Update canvas size on resize
window.addEventListener('resize', () => {
    setCanvasSize();
});

// Also update on orientation change and scroll
window.addEventListener('orientationchange', () => {
    setTimeout(setCanvasSize, 100);
});

// Canvas styling is handled in CSS, setCanvasSize is called in initSmokeEffect

// Track mouse position - create smoke behind cursor
let lastMouseX = 0;
let lastMouseY = 0;

// Track mouse position on entire document
document.addEventListener('mousemove', (e) => {
    // Check if canvas is ready
    if (!canvas || !ctx) return;
    
    // Get coordinates relative to viewport
    mouseX = e.clientX;
    mouseY = e.clientY;
    isMouseMoving = true;
    isTouch = false;
    
    // Calculate mouse speed for better smoke effect
    const speedX = Math.abs(mouseX - lastMouseX);
    const speedY = Math.abs(mouseY - lastMouseY);
    const speed = Math.sqrt(speedX * speedX + speedY * speedY);
    
    // Always create particles, more when moving faster
    const baseCount = isMobile ? 10 : 15;
    const speedBonus = Math.min(Math.floor(speed / 3), 12);
    const particleCount = baseCount + speedBonus;
    
    // Create smoke particles directly at cursor position
    for (let i = 0; i < particleCount; i++) {
        // Small random offset to create natural spread
        const offsetX = (Math.random() - 0.5) * 30;
        const offsetY = (Math.random() - 0.5) * 30;
        createParticle(mouseX + offsetX, mouseY + offsetY);
    }
    
    lastMouseX = mouseX;
    lastMouseY = mouseY;
}, { passive: true });

// Also support pointer events for broader device/browser coverage
document.addEventListener('pointermove', (e) => {
    if (!canvas || !ctx) return;
    mouseX = e.clientX;
    mouseY = e.clientY;
    isMouseMoving = true;
    isTouch = e.pointerType === 'touch' || e.pointerType === 'pen';
    const speedX = Math.abs(mouseX - lastMouseX);
    const speedY = Math.abs(mouseY - lastMouseY);
    const speed = Math.sqrt(speedX * speedX + speedY * speedY);
    const baseCount = isMobile ? 10 : 15;
    const speedBonus = Math.min(Math.floor(speed / 3), 12);
    const particleCount = baseCount + speedBonus;
    for (let i = 0; i < particleCount; i++) {
        const offsetX = (Math.random() - 0.5) * 30;
        const offsetY = (Math.random() - 0.5) * 30;
        createParticle(mouseX + offsetX, mouseY + offsetY);
    }
    lastMouseX = mouseX;
    lastMouseY = mouseY;
}, { passive: true });

// Ensure effect resumes when the pointer enters the window
window.addEventListener('mouseenter', (e) => {
    if (!canvas || !ctx) initSmokeEffect();
    isMouseMoving = false;
}, { passive: true });

// Also track on document body
document.body.addEventListener('mousemove', (e) => {
    mouseX = e.clientX;
    mouseY = e.clientY;
}, { passive: true });

// Continuous smoke effect - create particles everywhere randomly
function createContinuousSmoke() {
    // Create random particles across the screen occasionally
    if (Math.random() > 0.9) {
        const randomX = Math.random() * window.innerWidth;
        const randomY = Math.random() * window.innerHeight;
        // Create minimal background particles
        for (let i = 0; i < (isMobile ? 1 : 1); i++) {
            createParticle(randomX, randomY);
        }
    }
}

// Create continuous smoke every interval (background effect)
setInterval(createContinuousSmoke, 600);

// Touch support for mobile
document.addEventListener('touchmove', (e) => {
    if (e.touches.length > 0) {
        const touch = e.touches[0];
        mouseX = touch.clientX;
        mouseY = touch.clientY;
        isMouseMoving = true;
        isTouch = true;
        
        // Create particles on touch
        for (let i = 0; i < 12; i++) {
            const offsetX = (Math.random() - 0.5) * 30;
            const offsetY = (Math.random() - 0.5) * 30;
            createParticle(mouseX + offsetX, mouseY + offsetY);
        }
    }
}, { passive: true });

document.addEventListener('mouseout', () => {
    isMouseMoving = false;
});

document.addEventListener('touchend', () => {
    isMouseMoving = false;
});

// Particle class for smoke effect
class Particle {
    constructor(x, y) {
        this.x = x;
        this.y = y;
        // Dotted particle look: small radius
        this.size = Math.random() * 2.2 + 1.2; // 1.2px â€“ 3.4px
        // Gentle drift with slight upward motion
        this.speedX = (Math.random() - 0.5) * 0.9;
        this.speedY = - (Math.random() * 1.2 + 0.4); // upward
        this.opacity = 1;
        this.life = 1;
        this.decay = Math.random() * 0.04 + 0.015; // dots fade quicker
        // Store theme at creation to keep consistent color while fading
        this.isDark = body.classList.contains('dark-mode');
        // Soft twinkle factor
        this.twinkle = Math.random() * 0.4 + 0.8;
    }
    
    update() {
        this.x += this.speedX;
        this.y += this.speedY;
        this.life -= this.decay;
        // Opacity eases out
        this.opacity = Math.max(0, this.life) * this.twinkle;
        // light slowdown
        this.speedX *= 0.995;
        this.speedY *= 0.996;
    }
    
    draw() {
        const currentIsDark = body.classList.contains('dark-mode');
        const useDark = this.isDark !== undefined ? this.isDark : currentIsDark;
        const alpha = Math.max(0, Math.min(1, this.opacity));
        const color = useDark ? `rgba(255,255,255,${alpha})` : `rgba(0,0,0,${alpha})`;
        
        ctx.save();
        // subtle glow
        ctx.shadowBlur = 8;
        ctx.shadowColor = color;
        ctx.fillStyle = color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
    }
}

function createParticle(x, y) {
    // Check if canvas and context are initialized
    if (!canvas || !ctx) {
        // Try to initialize immediately
        initSmokeEffect();
        return;
    }
    
    // Dotted effect supports more particles at low cost
    const maxParticles = isMobile ? 180 : 320;
    if (particles.length > maxParticles) {
        particles.shift(); // Remove oldest particle
    }
    
    // Ensure coordinates are valid numbers
    if (isNaN(x) || isNaN(y)) return;
    
    particles.push(new Particle(x, y));
}

function animateParticles() {
    if (!canvas || !ctx) {
        requestAnimationFrame(animateParticles);
        return;
    }
    
    // Clear entire canvas using actual dimensions
    const width = canvas.width / (window.devicePixelRatio || 1);
    const height = canvas.height / (window.devicePixelRatio || 1);
    ctx.clearRect(0, 0, width, height);
    
    // Keep particle count bounded for performance
    const maxParticles = isMobile ? 160 : 300;
    if (particles.length > maxParticles) {
        particles = particles.slice(-maxParticles);
    }
    
    for (let i = particles.length - 1; i >= 0; i--) {
        particles[i].update();
        particles[i].draw();
        
        // Remove particles when they fade out or get too small or go off screen
        if (particles[i].life <= 0 || 
            particles[i].size < 1.5 || 
            particles[i].opacity < 0.01 ||
            particles[i].x < -50 || 
            particles[i].x > width + 50 ||
            particles[i].y < -50 || 
            particles[i].y > height + 50) {
            particles.splice(i, 1);
        }
    }
    
    requestAnimationFrame(animateParticles);
}

// Start particle animation - called from initSmokeEffect
// animateParticles(); // Moved to initSmokeEffect

// Robustness: reinitialize on page show (bfcache restore) and visibility changes
window.addEventListener('pageshow', () => {
    if (!canvas || !ctx) {
        initSmokeEffect();
    } else {
        setCanvasSize();
    }
}, { passive: true });

document.addEventListener('visibilitychange', () => {
    if (document.visibilityState === 'visible') {
        if (!canvas || !ctx) {
            initSmokeEffect();
        } else {
            setCanvasSize();
        }
    }
});

// Code Rain Effect (Dark Mode Only)
let codeRainInterval;
const codeSnippets = [
    'def function():', 'const x = 10;', 'function test() {', 
    'import React', 'return True', 'if (condition) {', 
    'class MyClass:', 'export default', 'try:', 'except:', 
    'async function', 'await fetch', 'for i in range:', 
    'console.log', 'print("Hello")', 'let arr = []', 
    'SELECT * FROM', 'UPDATE table', 'DELETE FROM'
];

function initCodeRain() {
    if (!body.classList.contains('dark-mode')) return;
    
    const codeRain = document.getElementById('code-rain');
    codeRain.innerHTML = '';
    
    codeRainInterval = setInterval(() => {
        if (!body.classList.contains('dark-mode')) {
            clearInterval(codeRainInterval);
            return;
        }
        
        createCodeSnippet();
    }, 300);
}

function stopCodeRain() {
    if (codeRainInterval) {
        clearInterval(codeRainInterval);
    }
    const codeRain = document.getElementById('code-rain');
    codeRain.innerHTML = '';
}

function createCodeSnippet() {
    if (!body.classList.contains('dark-mode')) return;
    
    const snippet = document.createElement('div');
    snippet.className = 'code-snippet';
    snippet.textContent = codeSnippets[Math.floor(Math.random() * codeSnippets.length)];
    snippet.style.left = Math.random() * 100 + '%';
    snippet.style.animationDuration = (Math.random() * 3 + 2) + 's';
    snippet.style.animationDelay = Math.random() * 2 + 's';
    
    document.getElementById('code-rain').appendChild(snippet);
    
    // Remove after animation
    setTimeout(() => {
        if (snippet.parentNode) {
            snippet.parentNode.removeChild(snippet);
        }
    }, 5000);
}

// Scroll Animation - reveal elements on scroll with smooth transitions
function initScrollAnimation() {
    const observerOptions = {
        threshold: 0.05, // Lower threshold for earlier trigger
        rootMargin: '0px 0px -50px 0px' // More margin for earlier trigger
    };
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry, index) => {
            if (entry.isIntersecting) {
                // Add delay based on element position for staggered animation
                const delay = index % 3 * 0.08;
                setTimeout(() => {
                    entry.target.classList.add('scroll-visible');
                    // Add visible class to sections
                    if (entry.target.tagName === 'SECTION') {
                        entry.target.classList.add('visible');
                    }
                }, delay * 1000);
            } else {
                // Smooth fade out when leaving viewport (for both scroll up and down)
                entry.target.classList.remove('scroll-visible');
                if (entry.target.tagName === 'SECTION') {
                    entry.target.classList.remove('visible');
                }
            }
        });
    }, observerOptions);
    
    // Observe all sections with individual delays
    document.querySelectorAll('section').forEach((section, index) => {
        section.style.transitionDelay = `${index * 0.1}s`;
        observer.observe(section);
    });
    
    // Observe skill cards with staggered delays
    document.querySelectorAll('.skill-card').forEach((card, index) => {
        card.style.transitionDelay = `${(index % 4) * 0.08}s`;
        observer.observe(card);
    });
    
    // Observe project cards with staggered delays
    document.querySelectorAll('.project-card').forEach((card, index) => {
        card.style.transitionDelay = `${(index % 3) * 0.1}s`;
        observer.observe(card);
    });
    
    // Observe info items with staggered delays
    document.querySelectorAll('.info-item').forEach((item, index) => {
        item.style.transitionDelay = `${(index % 4) * 0.08}s`;
        observer.observe(item);
    });
    
    // Observe timeline items with staggered delays
    document.querySelectorAll('.timeline-item').forEach((item, index) => {
        item.style.transitionDelay = `${index * 0.1}s`;
        observer.observe(item);
    });
    
    // Observe stat cards with staggered delays
    document.querySelectorAll('.stat-card').forEach((card, index) => {
        card.style.transitionDelay = `${(index % 2) * 0.1}s`;
        observer.observe(card);
    });
    
    // Observe contact me subtitle
    document.querySelectorAll('.contact-me-subtitle').forEach((subtitle) => {
        subtitle.style.transitionDelay = '0.15s';
        observer.observe(subtitle);
    });
    
    // Observe contact form
    document.querySelectorAll('.contact-form').forEach((form) => {
        form.style.transitionDelay = '0.2s';
        observer.observe(form);
    });
    
    // Smooth initial load - show first section with delay
    const firstSection = document.querySelector('section');
    if (firstSection) {
        setTimeout(() => {
            firstSection.classList.add('visible');
        }, 300);
    }
    
    // Show header with smooth animation on load
    const header = document.querySelector('.header');
    if (header) {
        header.style.opacity = '0';
        header.style.transform = 'translateY(30px)';
        setTimeout(() => {
            header.style.transition = 'opacity 0.8s ease, transform 0.8s ease';
            header.style.opacity = '1';
            header.style.transform = 'translateY(0)';
        }, 150);
    }
}

// Contact Form Handler
function initContactForm() {
    const contactForm = document.getElementById('contact-form');
    if (!contactForm) return;
    
    contactForm.addEventListener('submit', (e) => {
        e.preventDefault();
        
        const formData = {
            fullname: document.getElementById('fullname').value,
            email: document.getElementById('email').value,
            message: document.getElementById('message').value
        };
        
        // Create mailto link with form data (no subject field in form)
        const localizedSubject = (translations[currentLang] && (translations[currentLang]["contact-me-title"] || translations[currentLang]["contact-title"])) || 'Contact';
        const subject = encodeURIComponent(localizedSubject);
        const body = encodeURIComponent(`Ism va Familiya: ${formData.fullname}\nEmail: ${formData.email}\n\nXabar:\n${formData.message}`);
        const mailtoLink = `mailto:malumnomalum973@gmail.com?subject=${subject}&body=${body}`;
        
        // Open email client
        window.location.href = mailtoLink;
        
        // Reset form
        contactForm.reset();
    });
}

// Scroll to Top Button
function initScrollToTop() {
    const scrollToTopBtn = document.getElementById('scroll-to-top');
    if (!scrollToTopBtn) return;
    
    // Show/hide button based on scroll position
    window.addEventListener('scroll', () => {
        if (window.pageYOffset > 300) {
            scrollToTopBtn.style.opacity = '1';
            scrollToTopBtn.style.visibility = 'visible';
            scrollToTopBtn.style.transform = 'translateY(0)';
        } else {
            scrollToTopBtn.style.opacity = '0';
            scrollToTopBtn.style.visibility = 'hidden';
            scrollToTopBtn.style.transform = 'translateY(20px)';
        }
    }, { passive: true });
    
    // Smooth scroll to top
    scrollToTopBtn.addEventListener('click', () => {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    });
}

// Initialize everything when DOM is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
        initLanguage();
        // Initialize smoke effect with small delay to ensure canvas is ready
        setTimeout(() => {
            initSmokeEffect();
        }, 50);
        initScrollAnimation();
        initScrollToTop();
        initContactForm();
        if (body.classList.contains('dark-mode')) {
            initCodeRain();
        }
    });
} else {
    // DOM is already ready
    initLanguage();
    // Initialize smoke effect with small delay to ensure canvas is ready
    setTimeout(() => {
        initSmokeEffect();
    }, 50);
    initScrollAnimation();
    initScrollToTop();
    initContactForm();
    if (body.classList.contains('dark-mode')) {
        initCodeRain();
    }
}


